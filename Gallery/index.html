<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Cascade Studio Gallery</title>
        <!--<heading style="display:none;">Cascade Studio</heading>-->
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta name="application-name" content="Cascade Studio">
        <meta name="description" content="A Full Live-Scripted CAD Kernel in the Browser">
        <meta name="keywords" content="SCAD, OpenSCAD, CAD, OpenCascade, Scripting">
        <meta name="author" content="Johnathon Selstad">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="theme-color" content="#1e1e1e">

        <!-- Include Tailwind.css -->
        <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-app.js"></script>
        <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-storage.js"></script>
        <!-- Include the Firebase Sign-in Auth UI -->
        <script src="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.js"></script>
        <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.css" />

        <!-- Inject Headers/Footers, Handle Basic Auth, etc. -->
        <script type="text/javascript" src = "/Gallery/js/main.js"></script>
        
    </head>

    <body style="margin: 0; background: rgb(54, 54, 54); color: white; ">
      <!-- Gallery Set of Cards -->
      <div class="flex flex-wrap justify-center -mb-4 p-4">

        <!-- An Example Card-->
        <div id="card" class="max-w-sm p-4" style="visibility:hidden;" hidden>
          <div class="max-w-sm rounded overflow-hidden shadow-lg bg-gray-800">
            <img id="project-thumbnail" class="w-full" src="/Gallery/img/card-top.jpg" alt="Sunset in the mountains">
            <div class="px-6 py-2">
              <div id="project-title" class="font-bold text-xl mb-0 text-white">Random Mountain</div>
            </div>
            <div class="flex px-6 py-1 justify-end">
              <span class="inline-block px-0 py-1 text-sm font-semibold text-gray-300 mr-1">by</span>
              <span id="project-author" class="inline-block px-0 py-1 text-sm font-semibold text-gray-300">zalo</span>
            </div>
          </div>
        </div>

        <!-- Populate the Flex Box with copies of the above card! -->
        <script>
          window.addEventListener('load', () => {
            let card       = document.getElementById("card");
            let title      = document.getElementById("project-title");
            let author     = document.getElementById("project-author");
            let thumbnail  = document.getElementById("project-thumbnail");
            let cardParent = card.parentElement;

            // Get a list of the newest projects in the database
            let pageNumber = 0; let projectsPerPage = 9;
            db.collection("projects").orderBy("modified")
              .startAt(pageNumber * projectsPerPage).limit(projectsPerPage)
              .get().then((projectQuery) => { // Query for 9 of the latest projects
                projectQuery.forEach((project) => {
                  let projectEntry   = project     .data();
                  projectEntry.author.get().then((authorQuery) => { // Get the Author's Info
                    let userEntry    = authorQuery .data();
                    storageRef.child('images/'+ authorQuery.id +'/'+project.id+'.png')
                      .getDownloadURL().then((url)=>{ // Get the Preview Image's Info

                        // Create the Project Preview Card
                        title.innerText  = projectEntry.name;
                        thumbnail.alt    = projectEntry.name;
                        thumbnail.src    = url;//projectEntry.preview;
                        author.innerText = userEntry.username;

                        let currentCard  = card.cloneNode(true);
                        currentCard.style.visibility = "visible";
                        currentCard.hidden = false;
                        cardParent.appendChild(currentCard);
                      });
                  });
                });
            });
          });
        </script>

      </div> <!-- End Card Gallery Flex Box -->

    </body>
</html>
